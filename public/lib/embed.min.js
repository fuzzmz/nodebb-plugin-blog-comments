(function(){"use strict";function l(){try{return c=new XMLHttpRequest}catch(e){try{return c=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return c=new ActiveXObject("Msxml2.XMLHTTP")}}}function d(e){n=i.value;p=window.open(nodeBBURL+"/"+e+"/#blog/authenticate","_blank","toolbar=no, scrollbars=no, resizable=no, width=600, height=675");var t=setInterval(function(){if(p.closed){clearInterval(t);h=0;m()}},500)}function v(e){return e.replace(/href="\/(?=\w)/g,'href="'+nodeBBURL+"/").replace(/src="\/(?=\w)/g,'src="'+nodeBBURL+"/")}function m(){c.open("GET",nodeBBURL+"/comments/get/"+articleID+"/"+h,true);c.withCredentials=true;c.send()}function g(e){var t=[[60,"seconds",1],[120,"1 minute ago"],[3600,"minutes",60],[7200,"1 hour ago"],[86400,"hours",3600],[172800,"yesterday"],[604800,"days",86400],[1209600,"last week"],[2419200,"weeks",604800],[4838400,"last month"],[29030400,"months",2419200],[58060800,"last year"],[290304e4,"years",29030400]];var n=(+(new Date)-e)/1e3;if(n<10){return"just now"}var r=0,i;while(i=t[r++]){if(n<i[0]){if(!i[2]){return i[1]}else{return Math.floor(n/i[2])+" "+i[1]+" ago"}}}return e}function b(e,t){function n(e,t,n){var r=new RegExp("{"+e+"}","g");return n.replace(r,t)}function r(e){return new RegExp("<!--[\\s]*BEGIN "+e+"[\\s]*-->[\\s\\S]*<!--[\\s]*END "+e+"[\\s]*-->","g")}function i(e){return new RegExp("<!--[\\s]*IF "+e+"[\\s]*-->([\\s\\S]*?)<!--[\\s]*ENDIF "+e+"[\\s]*-->","g")}function s(e,t,n){s=n.match(e);if(s==null)return;if(t!==undefined)y.blocks[t]=s[0];var r=new RegExp("(\r\n)*<!-- BEGIN "+t+" -->(\r\n)*","g"),i=new RegExp("(\r\n)*<!-- END "+t+" -->(\r\n)*","g"),s=s[0].replace(r,"").replace(i,"");return s}function o(e,t,n){return n.replace(e,t)}var u,a;return function f(e,t,u,a){function l(e,t){var n=i(e),r=u.match(n);if(r!==null){for(var s=0,o=r.length;s<o;s++){var a=r[s].split(/<!-- ELSE -->/);var f=new RegExp("(<!--[\\s]*IF "+e+"[\\s]*-->)|(<!--[\\s]*ENDIF "+e+"[\\s]*-->)","gi");if(a[1]){if(!t){u=u.replace(r[s],a[1].replace(f,""))}else{u=u.replace(r[s],a[0].replace(f,""))}}else{if(!t){u=u.replace(r[s],"")}else{u=u.replace(r[s],r[s].replace(f,""))}}}}}if(!e||e.length==0){u=""}for(var c in e){if(e.hasOwnProperty(c)){if(typeof e[c]==="undefined"){continue}else if(e[c]===null){u=n(t+c,"",u)}else if(e[c].constructor==Array){l(t+c+".length",e[c].length);l("!"+t+c+".length",!e[c].length);t+=c+".";var h=r(c),p=s(h,t.substring(0,t.length-1),u);if(p==null){t=t.replace(c+".","");continue}var d=e[c].length-1,v=0,m="";do{m+=f(e[c][v],t,p,{iterator:v,total:d})}while(v++<d);t=t.replace(c+".","");u=o(h,m,u)}else if(e[c]instanceof Object){u=f(e[c],c+".",u)}else{var g=t+c,y=typeof e[c]==="string"?e[c].replace(/^\s+|\s+$/g,""):e[c];l(g,y);l("!"+g,!y);if(a&&a.iterator){l("@first",a.iterator===0);l("!@first",a.iterator!==0);l("@last",a.iterator===a.total);l("!@last",a.iterator!==a.total)}u=n(g,y,u)}}}if(t){var h=new RegExp("{"+t+"[\\s\\S]*?}","g");u=u.replace(h,"");t=""}else{u=u.replace(/<!-- ELSE -->/gi,"ENDIF -->").replace(/<!-- IF([^@]*?)ENDIF([^@]*?)-->/gi,"")}return u}(e,"",t)}var e=window.location.protocol+"//"+window.location.host+window.location.pathname;var t=nodeBBURL+"/plugins/nodebb-plugin-blog-comments",n,r,i,s,o,u,a;var f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.setAttribute("href",t+"/css/comments.css");document.getElementsByTagName("head")[0].appendChild(f);document.getElementById("nodebb/comments").insertAdjacentHTML("beforebegin",'<div id="nodebb"></div>');r=document.getElementById("nodebb");var c=l(),h=0,p;c.onload=function(){if(c.status>=200&&c.status<400){var t=JSON.parse(c.responseText),f;s=document.getElementById("nodebb-comments-list");o=document.getElementById("nodebb-comments-count");u=document.getElementById("nodebb-comments-author");a=document.getElementById("nodebb-comments-category");t.relative_path=nodeBBURL;t.redirect_url=e;t.article_id=articleID;t.pagination=h;t.postCount=parseInt(t.postCount,10);for(var p in t.posts){if(t.posts.hasOwnProperty(p)){t.posts[p].timestamp=g(parseInt(t.posts[p].timestamp),10);if(t.posts[p]["blog-comments:url"]){delete t.posts[p]}}}if(o){o.innerHTML=t.postCount?t.postCount-1:0}if(a&&t.category){a.innerHTML='<a href="'+nodeBBURL+"/category/"+t.category.slug+'">'+t.category.name+"</a>"}if(u&&t.mainPost){u.innerHTML='<span class="nodebb-author"><img src="'+t.mainPost.user.picture+'" /> <a href="'+nodeBBURL+"/user/"+t.mainPost.user.userslug+'">'+t.mainPost.user.username+"</a></span>"}if(h){f=v(b(t,y.blocks["posts"]));s.innerHTML=s.innerHTML+f}else{f=b(t,t.template);r.innerHTML=v(f)}i=document.getElementById("nodebb-content");setTimeout(function(){var e=r.getElementsByTagName("li");for(var t in e){if(e.hasOwnProperty(t)){e[t].className=""}}},100);if(n){i.value=n}if(t.tid){var w=document.getElementById("nodebb-load-more");w.onclick=function(){h++;m()};if(t.posts.length){w.style.display="inline-block"}if(h*10+t.posts.length+1>=t.postCount){w.style.display="none"}if(typeof jQuery!=="undefined"&&jQuery()&&jQuery().fitVids){jQuery(r).fitVids()}if(t.user&&t.user.uid){var E=window.location.href.match(/error=[\w-]*/);if(E){E=E[0].split("=")[1];if(E==="too-many-posts"){E="Please wait before posting so soon."}else if(E==="content-too-short"){E="Please post a longer reply."}document.getElementById("nodebb-error").innerHTML=E}}else{document.getElementById("nodebb-register").onclick=function(){d("register")};document.getElementById("nodebb-login").onclick=function(){d("login")}}}else{if(t.isAdmin){var S=l();S.open("GET","/ghost/api/v0.1/posts/"+articleID);S.onload=function(){if(S.status>=200&&S.status<400){var n=JSON.parse(S.responseText),i=n.markdown.split("\n\n").slice(0,2).join("\n\n")+"\n\n**Click [here]("+e+") to see the full blog post**";document.getElementById("nodebb-content-markdown").value=i;document.getElementById("nodebb-content-title").value=n.title}else{r.innerHTML="Welcome "+t.user.username+', <a href="/ghost">sign in to Ghost</a> to enable the publish button.</a>'}};S.send()}}}};m();var y={blocks:{}}})()